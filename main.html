<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>自主装机报价系统</title>
    <script src="js/jquery-3.1.1.js"></script>
    <script src="js/bootstrap.js"></script>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/home.css">
    <script src="js/home.js"></script>
    <script src="js/my.js"></script>
</head>
<style>
    img {
        width: 32px;
        height: 32px;
    }
</style>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="main.html">自主装机报价系统</a>
        </div>
        <div>
            <!--向左对齐-->
            <ul class="nav navbar-nav navbar-left">

            </ul>
            <!--向右对齐-->
            <form id="navbar_form" class="navbar-form navbar-right" role="search">
                <!--<a class="btn btn-default" href="register.html">-->
                    <!--注册-->
                <!--</a>-->
                <!--<a class="btn btn-default" href="login.html">-->
                    <!--登录-->
                <!--</a>-->
            </form>
        </div>
    </div>
</nav>
<div class="container">
    <div class="row">
        <div class="col-lg-6"></div>
        <div class="col-lg-6 ">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="搜索配置单">
                <span class="input-group-btn">
						<button class="btn btn-default" type="button">
							搜索
						</button>
                </span>
            </div><!-- /input-group -->
        </div>
    </div>
    <div class="row">.</div>
    <div class="row">
        <div class="col-sm-5">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">
                        <h4>
                            产品列表
                        </h4>
                    </div>
                </div>
                <div class="list-group">
                    <a href="#" class="list-group-item" onclick="go('CPU')">
                        <h4 class="list-group-item-heading">
                            CPU
                        </h4>
                        <div id="cpu_div" class="list-group-item-text">
                            <!--<p class="pull-left">Intel奔腾G2130</p><span class="pull-right">￥399</span>-->
                            <!--<br/>-->
                        </div>
                    </a>
                    <a href="#" class="list-group-item" onclick="go('主板')">
                        <h4 class="list-group-item-heading">
                            主板
                        </h4>
                        <div id="board_div" class="list-group-item-text">
                            <!--<span class="pic"></span>-->
                        </div>
                    </a>
                    <a href="#" class="list-group-item" onclick="go('内存')">
                        <h4 class="list-group-item-heading">
                            内存
                        </h4>
                        <div id="mem_div" class="list-group-item-text">
                            <!--<span class="pic"></span>-->
                        </div>
                    </a>
                    <a href="#" class="list-group-item" onclick="go('显卡')">
                        <h4 class="list-group-item-heading">
                            显卡
                        </h4>
                        <div id="display_div" class="list-group-item-text">
                            <!--<span class="pic"></span>-->

                        </div>
                    </a>
                    <a href="#" class="list-group-item" onclick="go('电源')">
                        <h4 class="list-group-item-heading">
                            电源
                        </h4>
                        <div id="power_div" class="list-group-item-text">
                            <!--<span class="pic"></span>-->

                        </div>
                    </a>
                    <a href="#" class="list-group-item">
                        <h4 class="list-group-item-heading ">
                            合计
                        </h4>
                        <div id="sum_div" class="list-group-item-text">
                            <!--<span class="pic"></span>-->

                        </div>
                    </a>
                </div>
                <div class="panel-footer">
                    <form role="form">
                        <div class="form-group">
                            <label>配置单名称</label>
                            <input type="text" id="partTableName" class="form-control">
                            <label>配置单描述</label>
                            <textarea class="form-control" id="partTableDescribe" rows="3"></textarea>
                            <br>
                            <button type="submit"  id="buttonClick" onclick="postOrder();" class="btn layui-bg-cyan btn-default">提交</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div id="rightSide" class="col-sm-7">

        </div>
    </div>
</div>
<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    配件详细参数
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label class="control-label col-md-1">类型</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="type"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">型号</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="name"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">价格</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="price"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">详细参数</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="describe"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
</body>
<script>
    go('CPU');
    rightDiv = $('#rightSide');
    myModal1 = $("#myModal1");
    partType=$("#type")
    partName=$("#name")
    partPrice=$("#price")
    partDescribe=$("#describe")
    var orderCpu,orderBoard,orderMemory,orderVga,orderPower;
    var cpuPrice=0,boardPrice=0,memPrice=0,vgaPrice=0,powerPrice=0,priceSum=0
    function go(name) {
        switch (name) {
            case 'CPU':
                $.get('cpu.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case '主板':
                $.get('board.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case '内存':
                $.get('memory.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case '显卡':
                $.get('vga.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case '电源':
                $.get('power.html', function (data) {
                    rightDiv.html(data)
                });
                break;
        }
    }


    $(function () {
        setInterval("checkLogin()",1*500);
    });

    function checkLogin() {
        $.ajax({
            type: "GET",
            url: host + "/user/session",
            xhrFields:{
                withCredentials: true
            },
            success: function (msg) {
                navbarForm = $('#navbar_form')
                if(msg.code == 401) {
                    navbarForm.html("<a class=\"btn btn-default\" href=\"register.html\">\n" +
                        "                注册\n" +
                        "            </a>\n" +
                        "            <a class=\"btn btn-default\" href=\"login.html\">\n" +
                        "                登录\n" +
                        "            </a>")
                }
                if (msg.code == 200){
                    data = msg.data
                    userAccount = data.userAccount
                    navbarForm.html("<a style='margin-right: 20px;' href='user.html'>"+userAccount.userId+"</a>" +
                        "<a class='btn btn-default' onclick='removeSession()'>注销</a>")
                }
            }
        })
    }

    function removeSession() {
        $.ajax({
            type: "DELETE",
            url: host + "/user/session",
            xhrFields:{
                withCredentials: true
            },
            success: function (msg) {
                window.location.href = "main.html"
            }
        })
    }

    function select(type, name, price,describe, id) {
        o = null
        switch (type) {
            case 'cpu':
                o = $('#cpu_div');
                orderCpu = id;
                if(price != "暂无报价" ){
                    numStr=price.split("￥")
                    cpuPrice= parseInt(numStr[1])
                }
                break;
            case 'board':
                o = $('#board_div');
                orderBoard = id
                if(price != "已下市") {
                    numStr = price.split("￥")
                    boardPrice = parseInt(numStr[1])
                }
                break;
            case 'memory':
                o = $('#mem_div');
                orderMemory = id
                if(price != "暂无报价") {
                    numStr = price.split("￥")
                    memPrice = parseInt(numStr[1])
                }
                break;
            case 'vga':
                o = $('#display_div');
                orderVga = id
                if(price != "暂无报价") {
                    numStr = price.split("￥")
                    vgaPrice = parseInt(numStr[1])
                }
                break;
            case 'power':
                o = $('#power_div');
                orderPower = id
                if(price != "暂无报价") {
                    numStr = price.split("￥")
                    powerPrice = parseInt(numStr[1])
                }
                break;
        }
        if (o != null) {
            o.html("<p class=\"pull-left\">" + name + "</p><span class=\"pull-right\">" + price + "</span><br/>");
        }
        priceSum = 0
        priceSum = cpuPrice+boardPrice+memPrice+vgaPrice+powerPrice
        o = $("#sum_div")
        o.html("<span class=\"pull-right\">￥" + priceSum.toString() + "</span><br/>");
        var ss = new Array();
        ss = describe.split("；")
        describe = ""
        ss.forEach(function (item) {
            describe += item +"<br>"
        })
        partType.html(type)
        partName.html(name)
        partPrice.html(price)
        partDescribe.html(describe)
        myModal1.modal('show')
    }

    function postOrder() {
        var computerOrder = {
            price:priceSum
        }

        var computerPart = {
            cpuId:orderCpu,
            boardId:orderBoard,
            memId:orderMemory,
            powerId:orderPower,
            vgaId:orderVga,
            partTableName:$("#partTableName").val(),
            partTableDescribe:$("#partTableDescribe").val()
        }

        var orderDto = {
            computerPart:computerPart,
            computerOrder:computerOrder
        }

        $.ajax({
            cache:false,
            type:"POST",
            url:host+"/order/order",
            data:JSON.stringify(orderDto),
            contentType:"application/json",
            async:false,
            xhrFields:{
                withCredentials: true
            },
            success:function (msg) {
                if(msg.code == 200){
                    alert(msg.data)
                    window.location.href = "#"
                }
                if(msg.code == 400){
                    alert(msg.data)
                }
                if(msg.code == 401){
                    alert(msg.data)
                }
            }
        })
    }
</script>
</html>