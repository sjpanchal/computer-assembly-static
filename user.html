<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>自主装机报价系统</title>
    <script src="js/jquery-3.1.1.js"></script>
    <script src="js/bootstrap.js"></script>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/home.css">
    <script src="js/home.js"></script>
    <script src="js/my.js"></script>
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="main.html">自主装机报价系统</a>
        </div>
        <div>
            <!--向左对齐-->
            <ul class="nav navbar-nav navbar-left">

            </ul>
            <!--向右对齐-->
            <form id="navbar_form" class="navbar-form navbar-right" role="search">
                <!--<button class="btn btn-default" onclick="location='login.html'">-->
                    <!--登录-->
                <!--</button>-->
            </form>
        </div>
    </div>
</nav>
<div class="container">
    <div class="row">
        <div class="col-sm-3">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                            订单信息
                    </h4>
                </div>
                <div class="list-group">
                    <a href="#" class="list-group-item" onclick="go('orderList')">
                        <h4 class="list-group-item-heading">
                            我的订单
                        </h4>
                    </a>
                    <a href="#" class="list-group-item" onclick="go('')">
                        <h4 class="list-group-item-heading">

                        </h4>
                    </a>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        用户信息
                    </h4>
                </div>
                <div class="list-group">
                    <a href="#" class="list-group-item" onclick="go('userinfo')">
                        <h4 class="list-group-item-heading">
                            个人信息
                        </h4>
                    </a>
                    <a href="#" class="list-group-item" onclick="go('updateInfo')">
                        <h4 class="list-group-item-heading">
                            修改信息
                        </h4>
                    </a>
                    <a href="#" class="list-group-item" onclick="go('modifyPwd')">
                        <h4 class="list-group-item-heading">
                            修改密码
                        </h4>
                    </a>
                </div>
            </div>
        </div>
        <div id="rightSide" class="col-sm-9">
        </div>
    </div>
</div>
<!-- 模态框（Modal） -->
<div class="modal fade" id="orderModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    配件详细参数
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label class="control-label col-md-1">订单号</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="orderId"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">名称</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="name"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">价格</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="price"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">处理器</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="cpu"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">主板</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="board"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">内存</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="memory"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">电源</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="power"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">显卡</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="vga"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-md-1">备注</label>
                            <div class="col-md-4">
                                <p class="control-label" style="text-align: left" id="describe"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
</body>
<script>
    rightDiv = $('#rightSide');

    function go(name) {
        switch (name) {
            case 'modifyPwd':
                $.get('modifyPasspwd.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'updateInfo':
                $.get('updateUserInfo.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'userinfo':
                $.get('userInfo.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'orderList':
                $.get('orderList.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case '电源':
                $.get('power.html', function (data) {
                    rightDiv.html(data)
                });
                break;
        }
    }


    $(function () {
        setInterval("checkLogin()",1*500)
    });

    function checkLogin() {
        $.ajax({
            type: "GET",
            url: host + "/user/session",
            xhrFields:{
                withCredentials: true
            },
            success: function (msg) {
                navbarForm = $('#navbar_form')
                if(msg.code == 401) {
                    window.location.href = "main.html"
                }
                if (msg.code == 200){
                    data = msg.data
                    userAccount = data.userAccount
                    navbarForm.html("<a id='userId' style='margin-right: 20px;' href='user.html'>"+userAccount.userId+"</a>" +
                        "<a class='btn btn-default' onclick='removeSession()'>注销</a>")
                }
            }
        })
    }

    function removeSession() {
        $.ajax({
            type: "DELETE",
            url: host + "/user/session",
            xhrFields:{
                withCredentials: true
            },
            success: function (msg) {
                window.location.href = "main.html"
            }
        })
    }

    function modalShow(i) {
        orderId = $("#orderId")
        orderName = $("#name")
        orderPrice = $("#price")
        orderCpu = $("#cpu")
        orderMemory = $("#memory")
        orderBoard = $("#board")
        orderVga = $("#vga")
        orderPower = $("#power")
        orderDescribe = $("#describe")
        orderModal = $("#orderModal")
        $.ajax({
            type: "get",
            url: host + "/order/order/",
            xhrFields:{
                withCredentials: true
            },
            success: function (msg) {
                if(msg.code == 401){
                    alert("未登录")
                    window.location.href = "login.html"
                }
                if(msg.code == 200){
                    data = msg.data;
                    part = data[parseInt(i)].computerPart;
                    order = data[parseInt(i)].computerOrder;
                    orderId.html(order.orderId)
                    orderName.html(part.partTableName)
                    orderPrice.html(order.price)
                    orderCpu.html(part.cpuId)
                    orderMemory.html(part.memId)
                    orderBoard.html(part.boardId)
                    orderVga.html(part.vgaId)
                    orderPower.html(part.powerId)
                    orderDescribe.html(part.partTableDescribe)
                    orderModal.modal('show')
                }
            },
            error: function (msg) {
                alert("无法连接到服务器，请重新尝试")
            }
        })
    }
</script>
</html>