<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>自主装机报价系统</title>
    <script src="js/jquery-3.1.1.js"></script>
    <script src="js/bootstrap.js"></script>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/home.css">
    <script src="js/home.js"></script>
    <script src="js/my.js"></script>
    <link rel="stylesheet" href="css/bootstrap-multiselect.css">
    <script src="js/bootstrap-multiselect.js"></script>
    <script src="morris.js-0.5.1/morris.js"></script>
    <link rel="stylesheet" href="morris.js-0.5.1/morris.css">
    <script src="morris.js-0.5.1/raphael.min.js"></script>

</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="main.html">自主装机报价系统后台管理</a>
        </div>
        <div>
            <!--向左对齐-->
            <ul class="nav navbar-nav navbar-left">

            </ul>
            <!--向右对齐-->
            <form id="navbar_form" class="navbar-form navbar-right" role="search">
                <!--<button class="btn btn-default" onclick="location='login.html'">-->
                <!--登录-->
                <!--</button>-->
            </form>
        </div>
    </div>
</nav>
<div class="container">
    <div class="row">
        <div class="col-sm-3">
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        电脑配件管理
                    </h4>
                </div>
                <div class="list-group">
                    <a class="list-group-item" style="cursor: pointer" onclick="go('addCPU')">
                        <h4 class="list-group-item-heading">
                            添加CPU
                        </h4>
                    </a>
                    <a class="list-group-item" style="cursor: pointer" onclick="go('addBoard')">
                        <h4 class="list-group-item-heading">
                            添加主板
                        </h4>
                    </a>
                    <a class="list-group-item" style="cursor: pointer" onclick="go('addMemory')">
                        <h4 class="list-group-item-heading">
                            添加内存
                        </h4>
                    </a>
                    <a class="list-group-item" style="cursor: pointer" onclick="go('addVga')">
                        <h4 class="list-group-item-heading">
                            添加显卡
                        </h4>
                    </a>
                    <a class="list-group-item" style="cursor: pointer" onclick="go('addPower')">
                        <h4 class="list-group-item-heading">
                            添加电源
                        </h4>
                    </a>
                    <a class="list-group-item" style="cursor: pointer" onclick="go('delPart')">
                        <h4 class="list-group-item-heading">
                            删除配件
                        </h4>
                    </a>
                </div>
            </div>
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        客户管理
                    </h4>
                </div>
                <div class="list-group">
                    <a class="list-group-item" style="cursor: pointer" onclick="go('userList')">
                        <h4 class="list-group-item-heading">
                            客户信息
                        </h4>
                    </a>
                </div>
            </div>
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        订单管理
                    </h4>
                </div>
                <div class="list-group">
                    <a class="list-group-item" style="cursor: pointer" onclick="go('adminNotPay')">
                        <h4 class="list-group-item-heading">
                            未付款
                        </h4>
                    </a>
                </div>
                <div class="list-group">
                    <a class="list-group-item" style="cursor: pointer" onclick="go('adminNotExp')">
                        <h4 class="list-group-item-heading">
                            未发货
                        </h4>
                    </a>
                </div>
                <div class="list-group">
                    <a class="list-group-item" style="cursor: pointer" onclick="go('adminNotSign')">
                        <h4 class="list-group-item-heading">
                            未签收
                        </h4>
                    </a>
                </div>
                <div class="list-group">
                    <a class="list-group-item" style="cursor: pointer" onclick="go('adminSign')">
                        <h4 class="list-group-item-heading">
                            已评价
                        </h4>
                    </a>
                </div>
            </div>
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        管理员管理
                    </h4>
                </div>
                <div class="list-group">
                    <a class="list-group-item" style="cursor: pointer" onclick="go('addAdmin')">
                        <h4 class="list-group-item-heading">
                            授权管理员
                        </h4>
                    </a>
                    <a class="list-group-item" style="cursor: pointer" onclick="go('delAdmin')">
                        <h4 class="list-group-item-heading">
                            撤销管理员
                        </h4>
                    </a>
                </div>
            </div>
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        新闻信息管理
                    </h4>
                </div>
                <div class="list-group">
                    <a class="list-group-item" style="cursor: pointer" onclick="go('imageDv')">
                        <h4 class="list-group-item-heading">
                            轮播图片
                        </h4>
                    </a>
                    <a class="list-group-item" style="cursor: pointer" onclick="go('postNews')">
                        <h4 class="list-group-item-heading">
                            新闻管理
                        </h4>
                    </a>
                </div>
            </div>
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        数据统计
                    </h4>
                </div>
                <div class="list-group">
                    <a class="list-group-item" style="cursor: pointer" onclick="go('count')">
                        <h4 class="list-group-item-heading">
                            数据统计
                        </h4>
                    </a>
                </div>
            </div>
        </div>
        <div id="rightSide" class="col-sm-9">
        </div>
    </div>
</div>
<!-- 模态框（Modal） -->
<div class="modal fade" id="orderModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    配件详细参数
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">

                    <div class="col-md-12">
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label class="control-label col-md-2">订单号</label>
                                <div class="col-md-10">
                                    <p class="control-label" style="text-align: left" id="orderId"></p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">名称</label>
                                <div class="col-md-10">
                                    <p class="control-label" style="text-align: left" id="name"></p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">价格</label>
                                <div class="col-md-10">
                                    <p class="control-label" style="text-align: left" id="price"></p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">处理器</label>
                                <div class="col-md-10">
                                    <p class="control-label" style="text-align: left" id="cpu"></p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">主板</label>
                                <div class="col-md-10">
                                    <p class="control-label" style="text-align: left" id="board"></p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">内存</label>
                                <div class="col-md-10">
                                    <p class="control-label" style="text-align: left" id="memory"></p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">电源</label>
                                <div class="col-md-10">
                                    <p class="control-label" style="text-align: left" id="power"></p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">显卡</label>
                                <div class="col-md-10">
                                    <p class="control-label" style="text-align: left" id="vga"></p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">备注</label>
                                <div class="col-md-10">
                                    <p class="control-label" style="text-align: left" id="describe"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
</body>
<script>
    rightDiv = $('#rightSide');

    function go(name) {
        switch (name) {
            case 'addCPU':
                $.get('addCPU.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'addBoard':
                $.get('addBoard.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'addVga':
                $.get('addVga.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'addMemory':
                $.get('addMemory.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'addPower':
                $.get('addPower.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'delPart':
                $.get('delPart.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'addAdmin':
                $.get('addAdmin.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'delAdmin':
                $.get('delAdmin.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'userList':
                $.get('userList.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'adminNotPay':
                $.get('adminNotPayOrder.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'adminNotExp':
                $.get('adminNotExpOrder.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'adminNotSign':
                $.get('adminNotSignOrder.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'adminSign':
                $.get('adminSignOrder.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'imageDv':
                $.get('imageDv.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'postNews':
                $.get('postNews.html', function (data) {
                    rightDiv.html(data)
                });
                break;
            case 'count':
                $.get('count.html', function (data) {
                    rightDiv.html(data)
                });
                break;
        }
    }


    $(function () {
         setInterval("checkLogin()", 1 * 500)
        checkLogin()
    });

    function checkLogin() {
        $.ajax({
            type: "GET",
            url: host + "/user/session",
            xhrFields: {
                withCredentials: true
            },
            success: function (msg) {
                navbarForm = $('#navbar_form')
                if (msg.code == 401) {
                    window.location.href = "login.html"
                }
                if (msg.code == 200) {
                    data = msg.data
                    userAccount = data.userAccount
                    userRole = data.userRole
                    if(userRole.userRole == 1){
                        navbarForm.html("<a style='margin-right: 20px;' href='user.html'>" + userAccount.userId + "</a>" +
                            "<a class='btn btn-default' onclick='removeSession()'>注销</a>")
                    }else {
                        navbarForm.html("<a style='margin-right: 20px;' href='admin.html'>" + userAccount.userId + "</a>" +
                            "<a class='btn btn-default' onclick='removeSession()'>注销</a>")
                    }
                }
            }
        })
    }

    function removeSession() {
        $.ajax({
            type: "DELETE",
            url: host + "/user/session",
            xhrFields: {
                withCredentials: true
            },
            success: function (msg) {
                window.location.href = "main.html"
            }
        })
    }

    function modalShow(i) {
        orderId = $("#orderId")
        orderName = $("#name")
        orderPrice = $("#price")
        orderCpu = $("#cpu")
        orderMemory = $("#memory")
        orderBoard = $("#board")
        orderVga = $("#vga")
        orderPower = $("#power")
        orderDescribe = $("#describe")
        orderModal = $("#orderModal")
        $.ajax({
            type: "get",
            url: host + "/order/order/",
            xhrFields: {
                withCredentials: true
            },
            success: function (msg) {
                if (msg.code == 401) {
                    alert("未登录")
                    window.location.href = "login.html"
                }
                if (msg.code == 200) {
                    data = msg.data;
                    part = data[parseInt(i)].computerPart;
                    order = data[parseInt(i)].computerOrder;
                    orderId.html(order.orderId)
                    orderName.html(part.partTableName)
                    orderPrice.html(order.price + "￥")
                    orderCpu.html(getName('CPU', part.cpuId).data.cpuName)
                    orderMemory.html(getName('内存', part.memId).data.memName)
                    orderBoard.html(getName('主板', part.boardId).data.boardName)
                    orderVga.html(getName('显卡', part.vgaId).data.vgaName)
                    orderPower.html(getName('电源', part.powerId).data.powerName)
                    orderDescribe.html(part.partTableDescribe)

                    // console.log()
                    orderModal.modal('show')
                }
            },
            error: function (msg) {
                alert("无法连接到服务器，请重新尝试")
            }
        })
    }

    function getName(type, id) {
        return $.ajax({
            type: "post",
            url: host + "/part/get-part",
            data: JSON.stringify({
                part: type,
                searchContent: "" + id
            }),
            contentType: "application/json",
            async: false,
            xhrFields: {
                withCredentials: true
            }
        }).responseJSON;
    }
</script>
</html>